{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECA/BC,EAAW,EAAAD,EAAEE,OAAO,CACtB,KAAM,EAAAF,EAAEG,SAASC,QAAQ,MAEvBC,EAAkB,CAAEC,KAAM,SAAUC,UAAWC,eAoBrD,MACMC,EAAaC,MAAOC,IACtB,GAAM,WAAYC,OAElB,IACI,MAAMC,QAAcC,OAAOC,KALhB,6BAOX,SADqBF,EAAMG,MAAML,GAE7B,OACJ,MAAMM,QAAiBC,MAAMP,EAAO,CAAEQ,KAAM,SACxCF,EAASG,UACHP,EAAMQ,IAAIV,EAAOM,EAASK,QAExC,CACA,MAAOC,GACHC,QAAQC,KAAK,yBAA0Bd,EAAOY,EAClD,GAEEG,EAAgBf,GACX,IAAIgB,QAAQC,IACf,MAAMC,EAAM,IAAIC,MAChBD,EAAIE,YAAc,YAClBF,EAAIG,OAAS,IAAMJ,IACnBC,EAAII,QAAU,IAAML,IACpBC,EAAIK,IAAMvB,IAGlBwB,EAAE,KACER,QAAQS,WA/CZ,WACI,MAAMC,EAAWpC,EAASqC,MAAMC,aAAalC,IAE7C,OADAmC,gBAAgBH,EAAUhC,GACnBoC,EAAEC,oBACJC,OAAOC,GAASA,EAAMC,SAAWD,EAAME,YAAYC,SAAS,QAC5DC,IAAIJ,IAAS,CACdK,MAAOL,EAAME,YAAYI,QAAQ,MAAO,IAAIC,WAAW,UAAW,IAClEC,QAASR,EAAMS,kBAEdC,OAAO,CAAC,CAAEL,MAAO,OAAQG,QAASf,EAAS,QAC3CW,IAAI,EAAGC,QAAOG,cAAc,CAC7BH,QACAM,OAAQH,EACHI,MAAM,MACNR,IAAIrC,GAASA,EAAM8C,QACnBd,OAAOhC,KAAWA,MAEtB+C,OACT,CA6BuBC,GAAiBC,QAAQC,GAAYA,EAASN,OAAOK,QAAQjD,GAAS,CAACe,EAAaf,GAAQF,EAAWE","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/image_preload/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","const Settings = z.object({\n    资源预载: z.string().default(''),\n});\nconst variable_option = { type: 'script', script_id: getScriptId() };\nfunction get_prefetches() {\n    const settings = Settings.parse(getVariables(variable_option));\n    insertVariables(settings, variable_option);\n    return _(getTavernRegexes())\n        .filter(regex => regex.enabled && regex.script_name.includes('预载-'))\n        .map(regex => ({\n        title: regex.script_name.replace('预载-', '').replaceAll(/【.+?】/gs, ''),\n        content: regex.replace_string,\n    }))\n        .concat([{ title: '脚本变量', content: settings.资源预载 }])\n        .map(({ title, content }) => ({\n        title,\n        assets: content\n            .split('\\n')\n            .map(asset => asset.trim())\n            .filter(asset => !!asset),\n    }))\n        .value();\n}\nconst CACHE_NAME = 'destined-journey-cache-v1';\nconst cacheAsset = async (asset) => {\n    if (!('caches' in window))\n        return;\n    try {\n        const cache = await caches.open(CACHE_NAME);\n        const cached = await cache.match(asset);\n        if (cached)\n            return;\n        const response = await fetch(asset, { mode: 'cors' });\n        if (response.ok) {\n            await cache.put(asset, response.clone());\n        }\n    }\n    catch (error) {\n        console.warn('[ImagePreload] 缓存资源失败:', asset, error);\n    }\n};\nconst preloadImage = (asset) => {\n    return new Promise(resolve => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onload = () => resolve();\n        img.onerror = () => resolve();\n        img.src = asset;\n    });\n};\n$(() => {\n    Promise.allSettled(get_prefetches().flatMap(prefetch => prefetch.assets.flatMap(asset => [preloadImage(asset), cacheAsset(asset)])));\n});\nexport {};\n"],"names":["z","Settings","object","string","default","variable_option","type","script_id","getScriptId","cacheAsset","async","asset","window","cache","caches","open","match","response","fetch","mode","ok","put","clone","error","console","warn","preloadImage","Promise","resolve","img","Image","crossOrigin","onload","onerror","src","$","allSettled","settings","parse","getVariables","insertVariables","_","getTavernRegexes","filter","regex","enabled","script_name","includes","map","title","replace","replaceAll","content","replace_string","concat","assets","split","trim","value","get_prefetches","flatMap","prefetch"],"ignoreList":[],"sourceRoot":""}