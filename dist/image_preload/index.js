const e=z,t=e.z.object({资源预载:e.z.string().default('')}),a={type:'script',script_id:getScriptId()};const n=async e=>{if('caches'in window)try{const t=await caches.open('destined-journey-cache-v1');if(await t.match(e))return;const a=await fetch(e,{mode:'cors'});a.ok&&await t.put(e,a.clone())}catch(t){console.warn('[ImagePreload] 缓存资源失败:',e,t)}},c=e=>new Promise(t=>{const a=new Image;a.crossOrigin='anonymous',a.onload=()=>t(),a.onerror=()=>t(),a.src=e});$(()=>{Promise.allSettled(function(){const e=t.parse(getVariables(a));return insertVariables(e,a),_(getTavernRegexes()).filter(e=>e.enabled&&e.script_name.includes('预载-')).map(e=>({title:e.script_name.replace('预载-','').replaceAll(/【.+?】/gs,''),content:e.replace_string})).concat([{title:'脚本变量',content:e.资源预载}]).map(({title:e,content:t})=>({title:e,assets:t.split('\n').map(e=>e.trim()).filter(e=>!!e)})).value()}().flatMap(e=>e.assets.flatMap(e=>[c(e),n(e)])))});